"use strict";(globalThis.webpackChunkshopify_academy=globalThis.webpackChunkshopify_academy||[]).push([[5721],{2785:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>p,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"app-integrations/webhook-logger","title":"Webhook \u65e5\u5fd7\u8bb0\u5f55\uff08Node\uff09","description":"\u5728 Node App \u4e2d\u628a Webhook \u8bf7\u6c42\u8bb0\u5f55\u5230\u6587\u4ef6\u6216\u5916\u90e8\u670d\u52a1\uff0c\u4fbf\u4e8e\u8c03\u8bd5\u4e0e\u91cd\u653e\u3002","source":"@site/recipes/app-integrations/webhook-logger.md","sourceDirName":"app-integrations","slug":"/app-integrations/webhook-logger","permalink":"/recipes/app-integrations/webhook-logger","draft":false,"unlisted":false,"editUrl":"https://github.com/shopxueyuan/shopxueyuan.github.io/edit/main/recipes/app-integrations/webhook-logger.md","tags":[],"version":"current","frontMatter":{"id":"webhook-logger","title":"Webhook \u65e5\u5fd7\u8bb0\u5f55\uff08Node\uff09"},"sidebar":"recipesSidebar","previous":{"title":"App \u96c6\u6210\u5bfc\u822a","permalink":"/recipes/app-integrations/"},"next":{"title":"\u6570\u636e\u4e0e\u76d1\u63a7","permalink":"/recipes/analytics/"}}');var r=n(4848),i=n(8453);const s={id:"webhook-logger",title:"Webhook \u65e5\u5fd7\u8bb0\u5f55\uff08Node\uff09"},a=void 0,p={},c=[];function l(e){const o={code:"code",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.p,{children:"\u5728 Node App \u4e2d\u628a Webhook \u8bf7\u6c42\u8bb0\u5f55\u5230\u6587\u4ef6\u6216\u5916\u90e8\u670d\u52a1\uff0c\u4fbf\u4e8e\u8c03\u8bd5\u4e0e\u91cd\u653e\u3002"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-js",children:"// webhook-logger.js\nimport fs from 'node:fs/promises';\nimport path from 'node:path';\n\nexport async function logWebhook(topic, shop, payload) {\n  const logLine = JSON.stringify({\n    ts: new Date().toISOString(),\n    topic,\n    shop,\n    payload,\n  });\n\n  const target = path.join(process.cwd(), 'storage', 'webhook.log');\n  await fs.mkdir(path.dirname(target), {recursive: true});\n  await fs.appendFile(target, `${logLine}\\n`);\n}\n"})}),"\n",(0,r.jsx)(o.p,{children:"\u5728\u5904\u7406\u5668\u4e2d\u8c03\u7528\uff1a"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-js",children:"shopify.webhooks.addHandlers({\n  PRODUCTS_CREATE: {\n    deliveryMethod: DeliveryMethod.Http,\n    callbackUrl: '/webhooks/products/create',\n    callback: async (topic, shop, body) => {\n      await logWebhook(topic, shop, body);\n    },\n  },\n});\n"})}),"\n",(0,r.jsx)(o.p,{children:"\u4e0a\u7ebf\u540e\u53ef\u66ff\u6362\u4e3a\u5bf9\u8c61\u5b58\u50a8\u6216\u65e5\u5fd7\u670d\u52a1\uff08S3\u3001Logtail \u7b49\uff09\uff0c\u786e\u4fdd\u4e0d\u963b\u585e\u4e3b\u6d41\u7a0b\u3002"})]})}function d(e={}){const{wrapper:o}={...(0,i.R)(),...e.components};return o?(0,r.jsx)(o,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,o,n)=>{n.d(o,{R:()=>s,x:()=>a});var t=n(6540);const r={},i=t.createContext(r);function s(e){const o=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function a(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(i.Provider,{value:o},e.children)}}}]);